# 3.3 Forum Module

## 3.3.1 View Posts

**Function Trigger:** The function is triggered when a user navigates to the forum page or when posts are loaded via pagination/infinite scroll.

**Screen Layout**

Figure 24 Forum Posts Screen

**Function Description:** The function displays a list of forum posts in chronological order (newest first). Users can view posts with their content, images, hashtags, author information, reaction counts, comment counts, and save counts. Posts support pagination and infinite scroll loading.

**Function Details:**

**Data:** The system displays:

- Post title (optional)
- Post content (text with clickable links)
- Post images (if any)
- Hashtags associated with the post
- Author username and avatar
- Creation timestamp
- Reaction summary (like/dislike counts)
- Comment count
- Save count
- User's own reaction status (if authenticated)

**Validation:**

- User must be authenticated to view posts (optional, some posts may be public)
- Posts are fetched with pagination (default 10 per page)
- Posts can be filtered by keyword search
- Posts can be filtered by hashtags
- Posts can be sorted by creation date (descending by default)

**Business Rules:** BR-07

**Normal & Abnormal Cases:**

**Normal:**

- Posts are loaded successfully
- Posts are displayed in a list format
- Pagination/infinite scroll works correctly
- Post images are displayed correctly
- Hashtags are clickable and filter posts
- Reaction counts and comment counts are accurate
- User can scroll to load more posts
- User can click on a post to view details

**Abnormal:**

- No posts found (empty state displayed)
- Network error while loading posts
- Posts fail to load
- Images fail to load
- Pagination fails
- Error message is displayed: "Failed to load posts" or "No posts found"

---

## 3.3.2 Create Post

**Function Trigger:** The function is triggered when an authenticated user clicks the "Create Post" button on the forum page or opens the post creation modal.

**Screen Layout**

Figure 25 Create Post Modal

**Function Description:** The function allows authenticated users to create a new forum post with optional title, content, images, hashtags, and link preview metadata. Posts can be created with either a title or content (or both), but at least one must be provided.

**Function Details:**

**Data:** Users can provide:

- Title (optional, required if content contains only links)
- Content (text with optional links)
- Images (multiple image files)
- Hashtags (array of hashtag strings)
- Link preview metadata (if content contains links)

**Validation:**

- User must be authenticated
- Either title or content must be provided (not both empty)
- If content contains only links (no other text), title is not required
- If content has text other than links, title is required
- Images must be valid image formats
- Hashtags are normalized to lowercase and deduplicated
- Content cannot be empty if title is empty
- Title cannot be empty if content contains only links

**Business Rules:** BR-08

**Normal & Abnormal Cases:**

**Normal:**

- Post created successfully
- Post is saved to database
- Images are uploaded and stored
- Hashtags are created or linked to existing hashtags
- User action is logged
- A toast message is displayed: "Post created successfully"
- Post appears in the forum list
- User is redirected to view the new post or stays on forum page

**Abnormal:**

- User not authenticated
- Both title and content are empty
- Title is empty when content has non-link text
- Image upload fails
- Invalid image format
- Network error during creation
- A toast message is displayed with appropriate error
- User remains on create post modal

---

## 3.3.3 Update Post

**Function Trigger:** The function is triggered when the post owner clicks the "Edit" button on their own post.

**Screen Layout**

Figure 26 Edit Post Modal

**Function Description:** The function allows post owners to update their existing posts. Users can modify title, content, images, and hashtags. Old images and hashtags are replaced with new ones.

**Function Details:**

**Data:** Users can update:

- Title
- Content
- Images (old images are deleted, new ones uploaded)
- Hashtags (old hashtags are removed, new ones added)

**Validation:**

- User must be authenticated
- User must be the owner of the post
- Either title or content must be provided (not both empty)
- Post must exist
- Same validation rules as create post apply

**Business Rules:** BR-09

**Normal & Abnormal Cases:**

**Normal:**

- Post updated successfully
- Old images are deleted
- Old hashtags are removed
- New images are uploaded
- New hashtags are created or linked
- A toast message is displayed: "Post updated successfully"
- Updated post is displayed in the forum

**Abnormal:**

- User not authenticated
- User is not the post owner
- Post not found
- Both title and content are empty
- Image upload fails
- Network error
- A toast message is displayed with appropriate error
- User remains on edit post modal

---

## 3.3.4 Delete Post

**Function Trigger:** The function is triggered when the post owner clicks the "Delete" button on their post and confirms the deletion.

**Screen Layout**

Figure 27 Delete Post Confirmation Modal

**Function Description:** The function allows post owners, admins, or staff to delete posts. When a post is deleted, all related saved posts, comments, reactions, and images are also deleted (cascade delete).

**Function Details:**

**Data:** System processes:

- Post ID
- User email (for authorization check)

**Validation:**

- User must be authenticated
- User must be the post owner, ADMIN, or STAFF
- STAFF cannot delete ADMIN posts
- Post must exist
- All related data (saved posts, comments, reactions, images) are deleted

**Business Rules:** BR-10

**Normal & Abnormal Cases:**

**Normal:**

- Post deleted successfully
- All related saved posts are deleted
- All comments are deleted (cascade)
- All reactions are deleted (cascade)
- All images are deleted
- A toast message is displayed: "Post deleted successfully"
- Post is removed from the forum list
- User is redirected to forum list if viewing single post

**Abnormal:**

- User not authenticated
- User is not authorized (not owner, admin, or staff)
- STAFF trying to delete ADMIN post
- Post not found
- Network error
- A toast message is displayed: "Unable to delete post. Please try again."
- Post remains visible

---

## 3.3.5 Save Post

**Function Trigger:** The function is triggered when an authenticated user clicks the "Save" button on a post.

**Screen Layout**

Figure 28 Save Post Button

**Function Description:** The function allows users to save posts to their personal collection for later viewing. Users can save any post, including their own posts. Saved posts can include an optional note.

**Function Details:**

**Data:** Users can provide:

- Post ID
- Optional note (personal note about the saved post)

**Validation:**

- User must be authenticated
- Post must exist
- User must not have already saved this post
- Post can be saved even if user is the author

**Business Rules:** BR-11

**Normal & Abnormal Cases:**

**Normal:**

- Post saved successfully
- Saved post is added to user's collection
- Save count for the post increases
- A toast message is displayed: "Post saved"
- Save button changes to "Unsave"
- User can view saved posts in their profile

**Abnormal:**

- User not authenticated
- Post not found
- Post already saved by user
- Network error
- A toast message is displayed with appropriate error
- Post is not saved

---

## 3.3.6 Report Post

**Function Trigger:** The function is triggered when a user clicks the "Report" button on a post.

**Screen Layout**

Figure 29 Report Post Modal

**Function Description:** The function allows users to report posts that violate community guidelines. Reports are submitted to admins/staff for review. Users can only report each post once.

**Function Details:**

**Data:** Users can provide:

- Post ID (target)
- Report reason/description
- Report type (target type: POST)

**Validation:**

- User must be authenticated
- Post must exist
- User must not have already reported this post
- Report reason should not be empty

**Business Rules:** BR-12

**Normal & Abnormal Cases:**

**Normal:**

- Report created successfully
- Report status is set to PENDING
- Report is visible to admins/staff
- User cannot report the same post again
- A toast message is displayed: "Report submitted successfully"
- Report button is disabled or shows "Reported"

**Abnormal:**

- User not authenticated
- Post not found
- User already reported this post
- Report reason is empty
- Network error
- A toast message is displayed with appropriate error
- Report is not created

---

## 3.3.7 React Post

**Function Trigger:** The function is triggered when a user clicks the "Like" or "Dislike" button on a post.

**Screen Layout**

Figure 30 Post Reaction Buttons

**Function Description:** The function allows users to react to posts with LIKE or DISLIKE reactions. Users can toggle their reaction (clicking the same reaction removes it, clicking a different reaction changes it). Reaction counts are displayed and updated in real-time.

**Function Details:**

**Data:** Users can provide:

- Post ID (target)
- Reaction type (LIKE or DISLIKE)
- User email (for identification)

**Validation:**

- User must be authenticated
- Post must exist
- Reaction type must be LIKE or DISLIKE
- If user already reacted with the same type, reaction is removed
- If user already reacted with different type, reaction is updated

**Business Rules:** BR-13

**Normal & Abnormal Cases:**

**Normal:**

- Reaction added successfully
- Post reaction count is updated
- User's reaction status is displayed
- If same reaction clicked again, reaction is removed
- If different reaction clicked, reaction is updated
- A toast message is displayed: "Post liked" or "Post unliked"
- Reaction buttons reflect current state

**Abnormal:**

- User not authenticated
- Post not found
- Invalid reaction type
- Network error
- Reaction count may not update correctly
- A toast message is displayed with appropriate error

---

## 3.3.8 Search Posts

**Function Trigger:** The function is triggered when a user enters a search keyword in the forum search bar or selects hashtags to filter posts.

**Screen Layout**

Figure 31 Forum Search Bar

**Function Description:** The function allows users to search for posts by keyword and/or filter by hashtags. Search results are paginated and sorted by relevance or date.

**Function Details:**

**Data:** Users can provide:

- Search keyword (optional)
- Selected hashtags (optional, multiple)
- Page number (for pagination)
- Sort order (default: createdAt,desc)

**Validation:**

- Search keyword can be empty (searches all posts)
- Hashtags are normalized to lowercase
- Pagination parameters must be valid (page >= 0, size > 0)
- Sort field must be valid

**Business Rules:** BR-14

**Normal & Abnormal Cases:**

**Normal:**

- Search results are displayed
- Posts matching keyword and/or hashtags are shown
- Results are paginated correctly
- User can navigate between pages
- User can clear search and see all posts
- Search results update when filters change

**Abnormal:**

- No posts match search criteria (empty state displayed)
- Invalid pagination parameters
- Network error
- Search fails
- Error message is displayed: "Failed to search posts"
- No results are shown

---

## 3.3.9 Translate Post

**Function Trigger:** The function is triggered when a user clicks the "Translate" button on a post's content.

**Screen Layout**

Figure 32 Post Translate Button

**Function Description:** The function uses Gemini AI to translate post content into Korean. The translated text is displayed below the original content. Users can toggle between showing and hiding the translation.

**Function Details:**

**Data:** System processes:

- Post content (text to translate)

**Validation:**

- Post content must not be empty
- Gemini API must be accessible
- Translation request must be valid

**Business Rules:** BR-15

**Normal & Abnormal Cases:**

**Normal:**

- Translation request sent successfully
- Translated text is displayed below original content
- User can toggle translation visibility
- Translation is cached (if already translated, shows immediately)
- Button text changes to "Hide translation" when shown

**Abnormal:**

- Post content is empty
- Gemini API is unavailable
- Translation fails
- Network error
- Error message is displayed: "Translation failed"
- Translation is not shown

---

## 3.3.10 View Comments

**Function Trigger:** The function is triggered when a user views a post and comments are loaded, or when a user clicks "Show replies" on a comment.

**Screen Layout**

Figure 33 Comment Section

**Function Description:** The function displays comments associated with a post. Comments can have replies (nested comments). Comments show author information, content, images, reaction counts, and creation timestamp.

**Function Details:**

**Data:** The system displays:

- Comment content
- Comment images (if any)
- Author username and avatar
- Creation timestamp
- Reaction summary (like/dislike counts)
- Reply count
- Replies (nested comments, if any)
- User's own reaction status (if authenticated)

**Validation:**

- Post must exist
- Comments are loaded for the specific post
- Replies are loaded for parent comments
- User must be authenticated to view some comment details

**Business Rules:** BR-16

**Normal & Abnormal Cases:**

**Normal:**

- Comments are loaded successfully
- Comments are displayed in chronological order
- Replies are nested under parent comments
- Reaction counts are accurate
- User can expand/collapse replies
- Comments update when new ones are added

**Abnormal:**

- Post not found
- Comments fail to load
- Network error
- No comments found (empty state)
- Error message is displayed: "Failed to load comments"
- Comments are not displayed

---

## 3.3.11 Create Comment

**Function Trigger:** The function is triggered when an authenticated user types a comment in the comment input field and submits it, or clicks "Reply" on an existing comment.

**Screen Layout**

Figure 34 Comment Input Field

**Function Description:** The function allows authenticated users to create comments on posts. Comments can be top-level comments or replies to other comments. Comments can include text content and optional images.

**Function Details:**

**Data:** Users can provide:

- Post ID (forum post to comment on)
- Comment content (text)
- Optional image
- Optional parent comment ID (for replies)

**Validation:**

- User must be authenticated
- Post must exist
- Comment content must not be empty
- If parent comment ID is provided, parent comment must exist
- Image must be valid format (if provided)

**Business Rules:** BR-17

**Normal & Abnormal Cases:**

**Normal:**

- Comment created successfully
- Comment is saved to database
- Comment appears in the comment section
- If reply, comment is nested under parent
- User action is logged
- A toast message is displayed: "Comment posted"
- Comment count for post increases

**Abnormal:**

- User not authenticated
- Post not found
- Comment content is empty
- Parent comment not found (for replies)
- Image upload fails
- Network error
- A toast message is displayed with appropriate error
- Comment is not created

---

## 3.3.12 Update Comment

**Function Trigger:** The function is triggered when the comment owner clicks the "Edit" button on their comment.

**Screen Layout**

Figure 35 Edit Comment Modal

**Function Description:** The function allows comment owners to update their existing comments. Users can modify content and image.

**Function Details:**

**Data:** Users can update:

- Comment content
- Comment image (optional)

**Validation:**

- User must be authenticated
- User must be the comment owner
- Comment must exist
- Updated content must not be empty

**Business Rules:** BR-71

**Normal & Abnormal Cases:**

**Normal:**

- Comment updated successfully
- Updated comment is displayed
- A toast message is displayed: "Comment updated successfully"
- Comment reflects changes immediately

**Abnormal:**

- User not authenticated
- User is not the comment owner
- Comment not found
- Updated content is empty
- Network error
- A toast message is displayed with appropriate error
- Comment is not updated

---

## 3.3.13 Delete Comment

**Function Trigger:** The function is triggered when the comment owner clicks the "Delete" button on their comment and confirms deletion.

**Screen Layout**

Figure 36 Delete Comment Confirmation

**Function Description:** The function allows comment owners, admins, or staff to delete comments. When a comment is deleted, all replies to that comment are also deleted (cascade delete).

**Function Details:**

**Data:** System processes:

- Comment ID
- User email (for authorization check)

**Validation:**

- User must be authenticated
- User must be the comment owner, ADMIN, or STAFF
- STAFF cannot delete ADMIN comments
- Comment must exist
- All replies are deleted (cascade)

**Business Rules:** BR-19

**Normal & Abnormal Cases:**

**Normal:**

- Comment deleted successfully
- All replies are deleted
- Comment is removed from display
- Comment count for post decreases
- A toast message is displayed: "Comment deleted successfully"

**Abnormal:**

- User not authenticated
- User is not authorized
- STAFF trying to delete ADMIN comment
- Comment not found
- Network error
- A toast message is displayed with appropriate error
- Comment remains visible

---

## 3.3.14 React Comment

**Function Trigger:** The function is triggered when a user clicks the "Like" or "Dislike" button on a comment.

**Screen Layout**

Figure 37 Comment Reaction Buttons

**Function Description:** The function allows users to react to comments with LIKE or DISLIKE reactions. Same toggle behavior as post reactions - clicking the same reaction removes it, clicking a different reaction changes it.

**Function Details:**

**Data:** Users can provide:

- Comment ID (target)
- Reaction type (LIKE or DISLIKE)
- User email (for identification)

**Validation:**

- User must be authenticated
- Comment must exist
- Reaction type must be LIKE or DISLIKE
- Same toggle behavior as post reactions

**Business Rules:** BR-20

**Normal & Abnormal Cases:**

**Normal:**

- Reaction added/updated/removed successfully
- Comment reaction count is updated
- User's reaction status is displayed
- A toast message is displayed: "Comment liked" or "Comment unliked"
- Reaction buttons reflect current state

**Abnormal:**

- User not authenticated
- Comment not found
- Invalid reaction type
- Network error
- A toast message is displayed with appropriate error

---

## 3.3.15 Report Comment

**Function Trigger:** The function is triggered when a user clicks the "Report" button on a comment.

**Screen Layout**

Figure 38 Report Comment Modal

**Function Description:** The function allows users to report comments that violate community guidelines. Same functionality as reporting posts, but for comments.

**Function Details:**

**Data:** Users can provide:

- Comment ID (target)
- Report reason/description
- Report type (target type: COMMENT)

**Validation:**

- User must be authenticated
- Comment must exist
- User must not have already reported this comment
- Report reason should not be empty

**Business Rules:** BR-21

**Normal & Abnormal Cases:**

**Normal:**

- Report created successfully
- Report status is set to PENDING
- Report is visible to admins/staff
- User cannot report the same comment again
- A toast message is displayed: "Report submitted successfully"

**Abnormal:**

- User not authenticated
- Comment not found
- User already reported this comment
- Report reason is empty
- Network error
- A toast message is displayed with appropriate error

---

## 3.3.16 Translate Comment

**Function Trigger:** The function is triggered when a user clicks the "Translate" button on a comment's content.

**Screen Layout**

Figure 39 Comment Translate Button

**Function Description:** The function uses Gemini AI to translate comment content into Korean. Same functionality as translating posts, but for comments.

**Function Details:**

**Data:** System processes:

- Comment content (text to translate)

**Validation:**

- Comment content must not be empty
- Gemini API must be accessible
- Translation request must be valid

**Business Rules:** BR-22

**Normal & Abnormal Cases:**

**Normal:**

- Translation request sent successfully
- Translated text is displayed below original content
- User can toggle translation visibility
- Button text changes to "Hide translation" when shown

**Abnormal:**

- Comment content is empty
- Gemini API is unavailable
- Translation fails
- Network error
- Error message is displayed: "Translation failed"

---

## 3.3.17 View Hashtags

**Function Trigger:** The function is triggered when a user views the forum page and popular hashtags are displayed, or when a user searches for hashtags.

**Screen Layout**

Figure 40 Popular Hashtags Section

**Function Description:** The function displays popular hashtags based on post count and total reactions. Users can view hashtag statistics (post count, reaction count) and click hashtags to filter posts.

**Function Details:**

**Data:** The system displays:

- Hashtag content (text)
- Post count (number of posts using this hashtag)
- Total reactions (sum of reactions on posts with this hashtag)

**Validation:**

- Hashtags are sorted by popularity (post count and reactions)
- Hashtags can be searched by keyword
- Limit parameter controls how many hashtags are shown (default: 10)

**Business Rules:** BR-23

**Normal & Abnormal Cases:**

**Normal:**

- Popular hashtags are displayed
- Hashtag statistics are accurate
- User can click hashtag to filter posts
- User can search for hashtags
- Hashtags update when new posts are created

**Abnormal:**

- No hashtags found (empty state)
- Network error
- Hashtag search fails
- Error message is displayed: "Failed to load hashtags"
- Hashtags are not displayed
