# 3.6 User Module

## 3.6.1 View And Update Personal Information

**Function Trigger:** The function is triggered when a user navigates to their profile page or settings page.

**Screen Layout**

Figure 58 User Profile Screen

**Function Description:** The function allows users to view and update their personal information including username, email, phone, address, avatar, and other profile details.

**Function Details:**

**Data:** Users can view/update:

- Username
- Email (read-only, cannot be changed)
- Phone number
- Address
- Avatar image
- Date of birth
- Gender
- Other profile information

**Validation:**

- User must be authenticated
- Username must be unique (if changed)
- Phone must be unique (if changed)
- Avatar must be valid image format
- Email cannot be changed

**Business Rules:** BR-41

**Normal & Abnormal Cases:**

**Normal:**

- Profile information is loaded successfully
- User can update information
- Changes are saved successfully
- Avatar is uploaded and updated
- A toast message is displayed: "Profile updated successfully"

**Abnormal:**

- User not authenticated
- Username already exists
- Phone already exists
- Invalid image format
- Network error
- A toast message is displayed with appropriate error

---

## 3.6.2 View List Of Messages

**Function Trigger:** The function is triggered when a user navigates to the messages/chat page.

**Screen Layout**

Figure 59 Messages List Screen

**Function Description:** The function displays a list of conversations/messages that the user has participated in. Users can see all their chat conversations with other users.

**Function Details:**

**Data:** The system displays:

- Conversation participants
- Last message preview
- Last message timestamp
- Unread message count
- User avatars

**Validation:**

- User must be authenticated
- Messages are filtered by user
- Conversations are sorted by last message time

**Business Rules:** BR-42

**Normal & Abnormal Cases:**

**Normal:**

- Messages list is loaded successfully
- Conversations are displayed
- User can click conversation to view messages
- Unread counts are accurate

**Abnormal:**

- No messages found (empty state)
- User not authenticated
- Network error
- Messages fail to load

---

## 3.6.3 View List Of Notifications

**Function Trigger:** The function is triggered when a user clicks the notification bell icon or navigates to notifications page.

**Screen Layout**

Figure 60 Notifications List Screen

**Function Description:** The function displays all notifications for the user, including booking updates, new messages, system announcements, etc. Notifications can be marked as read/unread.

**Function Details:**

**Data:** The system displays:

- Notification title
- Notification message
- Notification type
- Creation timestamp
- Read/unread status
- Target information (booking ID, tour ID, etc.)

**Validation:**

- User must be authenticated
- Notifications are filtered by user
- Notifications are paginated
- Notifications are sorted by creation date (newest first)

**Business Rules:** BR-43

**Normal & Abnormal Cases:**

**Normal:**

- Notifications are loaded successfully
- Unread count is displayed
- User can mark notifications as read
- User can click notification to view details
- Real-time notifications via WebSocket

**Abnormal:**

- No notifications found (empty state)
- User not authenticated
- Network error
- Notifications fail to load

---

## 3.6.4 View Transaction History

**Function Trigger:** The function is triggered when a user navigates to their transaction history page.

**Screen Layout**

Figure 61 Transaction History Screen

**Function Description:** The function displays all financial transactions made by the user, including payments for bookings, refunds, and other transactions.

**Function Details:**

**Data:** The system displays:

- Transaction ID
- Order ID
- Transaction amount
- Transaction status
- Transaction date
- Order information
- Payment method

**Validation:**

- User must be authenticated
- Transactions are filtered by user ID
- Transactions are sorted by date (newest first)

**Business Rules:** BR-44

**Normal & Abnormal Cases:**

**Normal:**

- Transaction history is loaded successfully
- Transactions are displayed with details
- User can filter transactions by status
- Transaction amounts are accurate

**Abnormal:**

- No transactions found (empty state)
- User not authenticated
- Network error
- Transactions fail to load

---

## 3.6.5 Chat Realtime

**Function Trigger:** The function is triggered when a user opens a chat conversation or sends/receives a message.

**Screen Layout**

Figure 62 Chat Interface

**Function Description:** The function provides real-time chat functionality using WebSocket. Users can send and receive messages instantly, see typing indicators, and receive message delivery status.

**Function Details:**

**Data:** Users can send:

- Message text
- Optional images
- Receiver username/email

**Validation:**

- User must be authenticated
- Receiver must exist
- Message text must not be empty
- WebSocket connection must be established

**Business Rules:** BR-45

**Normal & Abnormal Cases:**

**Normal:**

- WebSocket connection established
- Messages are sent successfully
- Messages are received in real-time
- Message history is loaded
- Typing indicators work
- A toast message is displayed: "Message sent"

**Abnormal:**

- WebSocket connection fails
- Receiver not found
- Message sending fails
- Network error
- A toast message is displayed: "Failed to send message"

---

## 3.6.6 Create Ticket For System

**Function Trigger:** The function is triggered when a user clicks "Create Support Ticket" or "Contact Support" button.

**Screen Layout**

Figure 63 Create Support Ticket Modal

**Function Description:** The function allows users to create support tickets for system issues, questions, or requests. Tickets are sent to admins/staff for handling.

**Function Details:**

**Data:** Users can provide:

- Ticket subject/title
- Ticket description/message
- Ticket category (optional)
- Priority level (optional)

**Validation:**

- User must be authenticated
- Ticket subject must not be empty
- Ticket description must not be empty

**Business Rules:** BR-105

**Normal & Abnormal Cases:**

**Normal:**

- Ticket created successfully
- Ticket is sent to admins/staff
- User receives confirmation
- A toast message is displayed: "Ticket created successfully"

**Abnormal:**

- User not authenticated
- Subject or description is empty
- Network error
- A toast message is displayed with appropriate error

---

## 3.6.7 Approve Tour Completed

**Function Trigger:** The function is triggered when a user clicks "Confirm Tour Completed" button after a tour has ended.

**Screen Layout**

Figure 64 Confirm Tour Completion Button

**Function Description:** The function allows users to confirm that a tour has been completed. Both user and company can confirm, and if both confirm (or one confirms and 3 days pass), payment is released to the company.

**Function Details:**

**Data:** System processes:

- Booking ID
- User confirmation status

**Validation:**

- User must be authenticated
- Booking must exist
- Booking status must be BOOKING_SUCCESS_WAIT_FOR_CONFIRMED
- Tour end date must have passed

**Business Rules:** BR-47

**Normal & Abnormal Cases:**

**Normal:**

- User confirms tour completion
- If company also confirmed, booking status changes to BOOKING_SUCCESS
- Payment is distributed to company
- A toast message is displayed: "Tour completion confirmed"

**Abnormal:**

- User not authenticated
- Booking not found
- Booking not in correct status
- Tour not yet ended
- Network error

---

## 3.6.8 Change Password

**Function Trigger:** The function is triggered when a user navigates to change password page or clicks "Change Password" in settings.

**Screen Layout**

Figure 65 Change Password Screen

**Function Description:** The function allows authenticated users to change their password by providing current password and new password.

**Function Details:**

**Data:** Users must provide:

- Current password
- New password
- Confirm new password

**Validation:**

- User must be authenticated
- Current password must be correct
- New password must meet requirements (minimum 8 characters)
- New password and confirm password must match
- New password cannot be the same as current password

**Business Rules:** BR-107

**Normal & Abnormal Cases:**

**Normal:**

- Password changed successfully
- User is logged out (optional, for security)
- A toast message is displayed: "Password changed successfully"
- User can login with new password

**Abnormal:**

- User not authenticated
- Current password is incorrect
- New password doesn't meet requirements
- Passwords don't match
- Network error
- A toast message is displayed with appropriate error

---

## 3.6.9 Sign Out

**Function Trigger:** The function is triggered when a user clicks the "Sign Out" or "Logout" button in the navigation menu.

**Screen Layout**

Figure 66 Sign Out Button

**Function Description:** The function logs the user out of the system, invalidates their JWT token, clears user session, and redirects to the login page.

**Function Details:**

**Data:** System processes:

- User's JWT token
- User session data

**Validation:**

- User must be authenticated
- Token must be valid

**Business Rules:** BR-49

**Normal & Abnormal Cases:**

**Normal:**

- User is logged out successfully
- JWT token is invalidated (blacklisted)
- User session is cleared
- User is redirected to login page
- A toast message is displayed: "Logged out successfully"

**Abnormal:**

- Token already invalid
- Network error during logout
- Session clearing fails
- User remains logged in (rare)
