# 3.7 Company Dashboard Module

## 3.7.1 Create Tour

**Function Trigger:** The function is triggered when a COMPANY user navigates to the tour management page and clicks "Create New Tour" button.

**Screen Layout**

Figure 67 Create Tour Form

**Function Description:** The function allows company users to create new tours with detailed information including name, description, images, prices, schedule, duration, and other tour details.

**Function Details:**

**Data:** Companies can provide:

- Tour name
- Tour description (HTML content with images)
- Main tour image (required)
- Tour duration (in days)
- Tour expiration date
- Tour deadline (days before departure)
- Departure point
- Vehicle type
- Tour type
- Tour schedule (HTML content)
- Prices (adult, children, baby)
- Tour contents (multiple sections with descriptions and images)

**Validation:**

- User must have COMPANY role
- Main tour image is required
- Tour expiration date must be after deadline + 1 day
- All required fields must be filled
- Prices must be valid numbers

**Business Rules:** BR-50

**Normal & Abnormal Cases:**

**Normal:**

- Tour created successfully
- Tour status is set to NOT_APPROVED
- Tour images are uploaded
- Tour contents are saved
- A toast message is displayed: "Tour created successfully"
- Tour appears in company's tour list (pending approval)

**Abnormal:**

- User not authenticated or not COMPANY role
- Missing main tour image
- Invalid expiration date
- Missing required fields
- Network error
- A toast message is displayed with appropriate error

---

## 3.7.2 Update Tour

**Function Trigger:** The function is triggered when a COMPANY user clicks "Edit" button on one of their tours.

**Screen Layout**

Figure 68 Edit Tour Form

**Function Description:** The function allows company users to update their existing tours. All tour fields can be modified, and new images can be uploaded to replace old ones.

**Function Details:**

**Data:** Companies can update:

- All tour fields (same as create tour)
- Optional new main image (replaces old one)
- Tour contents (old contents are cleared, new ones added)

**Validation:**

- User must be COMPANY role
- User must own the tour
- Tour must exist
- Same validation rules as create tour

**Business Rules:** BR-51

**Normal & Abnormal Cases:**

**Normal:**

- Tour updated successfully
- Old contents are cleared
- New contents are saved
- Images are updated
- A toast message is displayed: "Tour updated successfully"
- Updated tour is displayed

**Abnormal:**

- User not authorized
- Tour not found
- User doesn't own the tour
- Invalid data
- Network error

---

## 3.7.3 Delete Tour

**Function Trigger:** The function is triggered when a COMPANY user clicks "Delete" button on one of their tours and confirms deletion.

**Screen Layout**

Figure 69 Delete Tour Confirmation

**Function Description:** The function allows company users to delete their tours. If the tour has bookings, it's disabled instead of deleted. If no bookings, it's permanently deleted.

**Function Details:**

**Data:** System processes:

- Tour ID
- User email (for authorization)

**Validation:**

- User must be COMPANY role
- User must own the tour
- Tour must exist

**Business Rules:** BR-52

**Normal & Abnormal Cases:**

**Normal:**

- If tour has bookings: Tour status changes to DISABLED
- If tour has no bookings: Tour is permanently deleted
- A toast message is displayed: "Tour deleted successfully"
- Tour is removed from active tours list

**Abnormal:**

- User not authorized
- Tour not found
- User doesn't own the tour
- Network error

---

## 3.7.4 View Own Tour

**Function Trigger:** The function is triggered when a COMPANY user navigates to their tour management page.

**Screen Layout**

Figure 70 Company Tours List

**Function Description:** The function displays all tours created by the company, showing tour status, booking counts, and other tour information.

**Function Details:**

**Data:** The system displays:

- Tour name
- Tour status (NOT_APPROVED, PUBLIC, DISABLED)
- Booking count
- Tour creation date
- Tour expiration date
- Tour prices

**Validation:**

- User must be COMPANY role
- Tours are filtered by company ID

**Business Rules:** BR-53

**Normal & Abnormal Cases:**

**Normal:**

- Company's tours are loaded successfully
- Tours are displayed with status information
- Company can see all their tours regardless of status

**Abnormal:**

- User not authenticated
- No tours found (empty state)
- Network error

---

## 3.7.5 View Tour's Bookings

**Function Trigger:** The function is triggered when a COMPANY user clicks on a tour to view its bookings or navigates to booking management page.

**Screen Layout**

Figure 71 Tour Bookings List

**Function Description:** The function displays all bookings for a specific tour, showing booking status, guest information, dates, and amounts.

**Function Details:**

**Data:** The system displays:

- Booking ID
- Customer contact information
- Departure date
- Number of guests
- Booking status
- Total amount
- Booking creation date

**Validation:**

- User must be COMPANY role
- Tour must belong to the company
- Bookings are filtered by tour ID

**Business Rules:** BR-54

**Normal & Abnormal Cases:**

**Normal:**

- Bookings are loaded successfully
- Bookings are displayed with all information
- Company can filter bookings by status
- Company can click booking to view details

**Abnormal:**

- Tour not found
- User not authorized
- No bookings found (empty state)
- Network error

---

## 3.7.6 View Tour's Booking Details

**Function Trigger:** The function is triggered when a COMPANY user clicks on a booking to view its details.

**Screen Layout**

Figure 72 Booking Details Screen

**Function Description:** The function displays detailed information about a specific booking including all guest information, contact details, insurance status, and booking history.

**Function Details:**

**Data:** The system displays:

- Complete booking information
- All guest details (name, birth date, gender, ID, nationality)
- Guest insurance status
- Contact information
- Booking status history
- Payment information
- Voucher information (if applied)

**Validation:**

- User must be COMPANY role
- Booking must belong to company's tour

**Business Rules:** BR-55

**Normal & Abnormal Cases:**

**Normal:**

- Booking details are loaded successfully
- All guest information is displayed
- Company can see insurance status for each guest
- Company can update insurance status

**Abnormal:**

- Booking not found
- User not authorized
- Network error

---

## 3.7.7 Approve Booking

**Function Trigger:** The function is triggered when a COMPANY user clicks "Approve" button on a booking.

**Screen Layout**

Figure 73 Approve Booking Button

**Function Description:** The function allows companies to approve bookings, changing status to BOOKING_SUCCESS_PENDING (waiting for payment) or BOOKING_SUCCESS_WAIT_FOR_CONFIRMED (if already paid).

**Function Details:**

**Data:** System processes:

- Booking ID
- Optional message to customer
- New status: BOOKING_SUCCESS_PENDING or BOOKING_SUCCESS_WAIT_FOR_CONFIRMED

**Validation:**

- User must be COMPANY role
- Booking must belong to company's tour
- Booking status must be WAITING_FOR_APPROVED

**Business Rules:** BR-56

**Normal & Abnormal Cases:**

**Normal:**

- Booking status updated successfully
- Customer is notified via email and notification
- A toast message is displayed: "Booking approved successfully"
- Booking moves to next status

**Abnormal:**

- Booking not found
- Booking not in correct status
- User not authorized
- Network error

---

## 3.7.8 Reject Booking

**Function Trigger:** The function is triggered when a COMPANY user clicks "Reject" button on a booking.

**Screen Layout**

Figure 74 Reject Booking Modal

**Function Description:** The function allows companies to reject bookings with an optional reason message. Rejected bookings cannot be paid or completed.

**Function Details:**

**Data:** Companies can provide:

- Booking ID
- Rejection reason/message (optional)
- New status: BOOKING_REJECTED

**Validation:**

- User must be COMPANY role
- Booking must belong to company's tour
- Booking status must be WAITING_FOR_APPROVED

**Business Rules:** BR-57

**Normal & Abnormal Cases:**

**Normal:**

- Booking status updated to REJECTED
- Customer is notified via email and notification
- A toast message is displayed: "Booking rejected"
- Booking is removed from active bookings

**Abnormal:**

- Booking not found
- Booking not in correct status
- User not authorized
- Network error

---

## 3.7.9 Create Booking Update Request

**Function Trigger:** The function is triggered when a COMPANY user clicks "Request Update" button on a booking.

**Screen Layout**

Figure 75 Request Booking Update Modal

**Function Description:** The function allows companies to request customers to update their booking information. Booking status changes to WAITING_FOR_UPDATE, and customer is notified.

**Function Details:**

**Data:** Companies can provide:

- Booking ID
- Update request message
- New status: WAITING_FOR_UPDATE

**Validation:**

- User must be COMPANY role
- Booking must belong to company's tour
- Booking status must be WAITING_FOR_APPROVED
- Message should not be empty

**Business Rules:** BR-58

**Normal & Abnormal Cases:**

**Normal:**

- Booking status updated to WAITING_FOR_UPDATE
- Customer is notified via email and notification
- A toast message is displayed: "Update request sent"
- Customer can now update booking information

**Abnormal:**

- Booking not found
- Booking not in correct status
- User not authorized
- Network error

---

## 3.7.10 Create Voucher

**Function Trigger:** The function is triggered when a COMPANY user navigates to voucher management and clicks "Create Voucher" button.

**Screen Layout**

Figure 76 Create Voucher Form

**Function Description:** The function allows companies to create discount vouchers for their tours. Vouchers can be percentage-based or fixed amount discounts.

**Function Details:**

**Data:** Companies can provide:

- Voucher code (unique per company)
- Discount type (PERCENT or FIXED)
- Discount value
- Minimum order value (optional)
- Start date
- End date
- Total quantity
- Associated tour IDs (optional, if empty applies to all company tours)
- Status (ACTIVE or INACTIVE)

**Validation:**

- User must be COMPANY role
- Voucher code must be unique for the company
- Discount value must be positive
- End date must be after start date
- Total quantity must be positive

**Business Rules:** BR-59

**Normal & Abnormal Cases:**

**Normal:**

- Voucher created successfully
- Voucher is linked to specified tours (or all company tours)
- Remaining quantity equals total quantity initially
- A toast message is displayed: "Voucher created successfully"
- Voucher appears in company's voucher list

**Abnormal:**

- Voucher code already exists for company
- Invalid discount value
- Invalid date range
- User not authorized
- Network error

---

## 3.7.11 View Company's Vouchers

**Function Trigger:** The function is triggered when a COMPANY user navigates to voucher management page.

**Screen Layout**

Figure 77 Company Vouchers List

**Function Description:** The function displays all vouchers created by the company, showing voucher details, usage statistics, and status.

**Function Details:**

**Data:** The system displays:

- Voucher code
- Discount information
- Valid date range
- Total quantity
- Remaining quantity
- Status
- Associated tours
- Usage count

**Validation:**

- User must be COMPANY role
- Vouchers are filtered by company ID

**Business Rules:** BR-60

**Normal & Abnormal Cases:**

**Normal:**

- Company's vouchers are loaded successfully
- Vouchers are displayed with all information
- Company can see usage statistics

**Abnormal:**

- User not authenticated
- No vouchers found (empty state)
- Network error

---

## 3.7.12 Approve Tour Completed

**Function Trigger:** The function is triggered when a COMPANY user clicks "Confirm Tour Completed" button after a tour has ended.

**Screen Layout**

Figure 78 Confirm Tour Completion Button (Company)

**Function Description:** The function allows companies to confirm that a tour has been completed. If both user and company confirm (or one confirms and 3 days pass), payment is released to the company.

**Function Details:**

**Data:** System processes:

- Booking ID
- Company confirmation status

**Validation:**

- User must be COMPANY role
- Booking must belong to company's tour
- Booking status must be BOOKING_SUCCESS_WAIT_FOR_CONFIRMED
- Tour end date must have passed

**Business Rules:** BR-61

**Normal & Abnormal Cases:**

**Normal:**

- Company confirms tour completion
- If user also confirmed, booking status changes to BOOKING_SUCCESS
- Payment is distributed to company (90%) and admin (10%)
- A toast message is displayed: "Tour completion confirmed"

**Abnormal:**

- Booking not found
- Booking not in correct status
- Tour not yet ended
- User not authorized
- Network error

---

## 3.7.13 Share Tour

**Function Trigger:** The function is triggered when a COMPANY user clicks "Share Tour" button on a tour.

**Screen Layout**

Figure 79 Share Tour Modal

**Function Description:** The function allows companies to share their tours via social media, email, or copy link. A shareable URL is generated for the tour.

**Function Details:**

**Data:** System generates:

- Tour share URL
- Tour preview information
- Share options (social media, email, copy link)

**Validation:**

- User must be COMPANY role
- Tour must exist
- Tour must belong to company

**Business Rules:** BR-122

**Normal & Abnormal Cases:**

**Normal:**

- Share URL is generated successfully
- User can copy link
- User can share via social media
- Share modal displays tour preview

**Abnormal:**

- Tour not found
- User not authorized
- Network error

---

## 3.7.14 Change Booking Guest Insurance Status

**Function Trigger:** The function is triggered when a COMPANY user updates the insurance status for a guest in booking details.

**Screen Layout**

Figure 80 Insurance Status Update

**Function Description:** The function allows companies to update the insurance status for individual guests in a booking. Status can be Success, Failed, or Pending.

**Function Details:**

**Data:** Companies can update:

- Booking guest ID
- Insurance status (Success, Failed, Pending)

**Validation:**

- User must be COMPANY role
- Booking guest must exist
- Booking must belong to company's tour
- Insurance status must be valid enum value

**Business Rules:** BR-63

**Normal & Abnormal Cases:**

**Normal:**

- Insurance status updated successfully
- Status change is saved
- A toast message is displayed: "Insurance status updated"
- Updated status is displayed in booking details

**Abnormal:**

- Booking guest not found
- Invalid insurance status
- User not authorized
- Network error
