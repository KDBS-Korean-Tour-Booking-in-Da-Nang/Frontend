# 3.5 Tour Booking Module

## 3.5.1 View Tours

**Function Trigger:** The function is triggered when a user navigates to the tours page or searches for tours.

**Screen Layout**

Figure 48 Tours List Screen

**Function Description:** The function displays a list of public tours that have been approved by admins/staff. Users can view tour details including name, description, images, prices, duration, departure point, and ratings.

**Function Details:**

**Data:** The system displays:

- Tour name
- Tour description
- Tour thumbnail image
- Tour duration
- Tour prices (adult, children, baby)
- Tour departure point
- Tour vehicle type
- Tour expiration date
- Tour ratings and reviews
- Tour status (only PUBLIC tours are shown)

**Validation:**

- Tours must have status PUBLIC to be visible
- Tours can be filtered by keyword, price range, and minimum rating
- Tours support pagination

**Business Rules:** BR-31

**Normal & Abnormal Cases:**

**Normal:**

- Public tours are loaded successfully
- Tours are displayed in grid/list format
- Tour images are displayed correctly
- User can click tour to view details
- Search and filters work correctly

**Abnormal:**

- No tours found (empty state)
- Network error
- Tours fail to load
- Error message is displayed: "Failed to load tours"

---

## 3.5.2 Rate Tour

**Function Trigger:** The function is triggered when a USER clicks "Rate Tour" button after completing a tour booking.

**Screen Layout**

Figure 49 Rate Tour Modal

**Function Description:** The function allows users to rate and review tours they have booked. Users can provide a rating (1-5 stars), written review, and optional images.

**Function Details:**

**Data:** Users can provide:

- Tour ID
- Rating (1-5 stars)
- Review text
- Optional images

**Validation:**

- User must be authenticated
- User must have role USER
- Tour must exist
- User can only rate each tour once
- Rating must be between 1 and 5
- Review text is optional but recommended

**Business Rules:** BR-32

**Normal & Abnormal Cases:**

**Normal:**

- Rating created successfully
- Rating is saved to database
- Tour average rating is updated
- Rating appears on tour detail page
- A toast message is displayed: "Rating submitted successfully"

**Abnormal:**

- User not authenticated
- User already rated this tour
- Tour not found
- Invalid rating value
- Network error
- A toast message is displayed with appropriate error

---

## 3.5.3 Book Tour

**Function Trigger:** The function is triggered when a USER clicks "Book Now" on a tour detail page and completes the booking wizard.

**Screen Layout**

Figure 50 Tour Booking Wizard

**Function Description:** The function allows users to create a booking for a tour. The booking process includes multiple steps: selecting departure date, providing guest information, contact details, and payment.

**Function Details:**

**Data:** Users can provide:

- Tour ID
- Departure date
- Number of adults, children, babies
- Guest information (name, birth date, gender, ID number, nationality, insurance status)
- Contact information (name, address, phone, email)
- Pickup point
- Optional note
- Optional voucher code

**Validation:**

- User must be authenticated with role USER
- Tour must exist and be PUBLIC
- Departure date must be valid (after deadline + 1 day, before expiration date)
- Guest counts must match actual guest information provided
- At least one adult guest required
- Contact information must be valid
- All required guest fields must be filled

**Business Rules:** BR-92

**Normal & Abnormal Cases:**

**Normal:**

- Booking created successfully
- Booking status is PENDING_PAYMENT
- Booking guests are saved
- Auto-failed date is set (deadline days from now)
- Tour end date is calculated (departure date + tour duration)
- Notification sent to company
- A toast message is displayed: "Booking created successfully"
- User is redirected to payment page

**Abnormal:**

- User not authenticated
- Tour not found or not public
- Invalid departure date
- Guest count mismatch
- Missing required information
- Network error
- A toast message is displayed with appropriate error

---

## 3.5.4 View Tour Rates

**Function Trigger:** The function is triggered when a user views a tour detail page and ratings/reviews are displayed.

**Screen Layout**

Figure 51 Tour Ratings Section

**Function Description:** The function displays all ratings and reviews for a specific tour, including user names, ratings, review text, images, and creation dates.

**Function Details:**

**Data:** The system displays:

- User username
- Rating (1-5 stars)
- Review text
- Review images (if any)
- Creation date
- Average rating for the tour

**Validation:**

- Tour must exist
- Ratings are loaded for the specific tour
- Only approved/completed bookings can have ratings

**Business Rules:** BR-34

**Normal & Abnormal Cases:**

**Normal:**

- Ratings are loaded successfully
- Ratings are displayed in chronological order
- Average rating is calculated correctly
- User can view all reviews
- Ratings update when new ones are added

**Abnormal:**

- Tour not found
- No ratings found (empty state)
- Network error
- Ratings fail to load

---

## 3.5.5 View Available Vouchers For Tour

**Function Trigger:** The function is triggered when a user views a tour detail page and available vouchers are displayed, or during booking when selecting vouchers.

**Screen Layout**

Figure 52 Available Vouchers Section

**Function Description:** The function displays vouchers that are available for a specific tour. Vouchers can be company-wide or tour-specific.

**Function Details:**

**Data:** The system displays:

- Voucher code
- Discount type (percentage or fixed amount)
- Discount value
- Minimum order value
- Valid date range
- Remaining quantity

**Validation:**

- Tour must exist
- Vouchers must belong to the tour's company
- Vouchers must be ACTIVE
- Vouchers must be within valid date range
- Vouchers must have remaining quantity
- Vouchers must meet minimum order value (if specified)

**Business Rules:** BR-35

**Normal & Abnormal Cases:**

**Normal:**

- Available vouchers are displayed
- Vouchers show discount information
- User can select voucher to apply
- Voucher discount is calculated correctly

**Abnormal:**

- No vouchers available (empty state)
- Tour not found
- Network error
- Vouchers fail to load

---

## 3.5.6 View Available Vouchers For Booking

**Function Trigger:** The function is triggered during booking process when user is on payment step and wants to apply a voucher.

**Screen Layout**

Figure 53 Booking Voucher Selection

**Function Description:** The function displays vouchers available for the current booking, showing preview of discount amount and final total.

**Function Details:**

**Data:** The system displays:

- Voucher code
- Original booking total
- Discount amount
- Final total after discount
- Voucher validity information

**Validation:**

- Booking must exist
- Booking must be in PENDING_PAYMENT status
- Vouchers must be valid for the booking's tour
- Voucher must meet minimum order value
- Booking total must be calculated correctly

**Business Rules:** BR-95

**Normal & Abnormal Cases:**

**Normal:**

- Available vouchers are displayed with preview
- Discount is calculated correctly
- User can select voucher
- Final total updates when voucher is selected
- Voucher is attached to booking

**Abnormal:**

- No vouchers available
- Booking not found
- Voucher invalid for this booking
- Network error

---

## 3.5.7 View All Vouchers

**Function Trigger:** The function is triggered when a user navigates to vouchers page or company views their vouchers.

**Screen Layout**

Figure 54 All Vouchers List

**Function Description:** The function displays all vouchers in the system (for admins) or company's vouchers (for companies).

**Function Details:**

**Data:** The system displays:

- Voucher code
- Company name
- Discount information
- Valid date range
- Status
- Remaining quantity
- Associated tours

**Validation:**

- User must be authenticated
- Admins can view all vouchers
- Companies can only view their own vouchers

**Business Rules:** BR-37

**Normal & Abnormal Cases:**

**Normal:**

- Vouchers are loaded successfully
- Vouchers are displayed with all information
- User can filter/search vouchers

**Abnormal:**

- No vouchers found
- User not authorized
- Network error

---

## 3.5.8 Update Booking

**Function Trigger:** The function is triggered when a company requests booking update and user clicks "Update Booking" button.

**Screen Layout**

Figure 55 Update Booking Modal

**Function Description:** The function allows users to update booking information when company requests changes. Users can modify guest information, contact details, and other booking fields.

**Function Details:**

**Data:** Users can update:

- Guest information
- Contact information
- Departure date (if allowed)
- Pickup point
- Note

**Validation:**

- User must be authenticated
- Booking must exist
- Booking status must be WAITING_FOR_UPDATE
- User must be the booking owner
- Updated information must be valid
- Guest counts must match

**Business Rules:** BR-97

**Normal & Abnormal Cases:**

**Normal:**

- Booking updated successfully
- Booking status changes to WAITING_FOR_APPROVED
- Company is notified
- A toast message is displayed: "Booking updated successfully"

**Abnormal:**

- User not authenticated
- Booking not found
- Booking not in WAITING_FOR_UPDATE status
- User not authorized
- Invalid information
- Network error

---

## 3.5.9 View Booking History

**Function Trigger:** The function is triggered when a user navigates to their booking history page.

**Screen Layout**

Figure 56 Booking History Screen

**Function Description:** The function displays all bookings made by the user, showing booking status, tour information, dates, and amounts.

**Function Details:**

**Data:** The system displays:

- Booking ID
- Tour name
- Departure date
- Booking status
- Total guests
- Total amount
- Booking creation date
- Payment status

**Validation:**

- User must be authenticated
- Bookings are filtered by user email
- Bookings are sorted by creation date (newest first)

**Business Rules:** BR-39

**Normal & Abnormal Cases:**

**Normal:**

- Booking history is loaded successfully
- Bookings are displayed in list format
- User can click booking to view details
- Booking statuses are accurate

**Abnormal:**

- No bookings found (empty state)
- User not authenticated
- Network error
- Bookings fail to load

---

## 3.5.10 Create Complaint

**Function Trigger:** The function is triggered when a user clicks "Create Complaint" button on a completed booking.

**Screen Layout**

Figure 57 Create Complaint Modal

**Function Description:** The function allows users to create complaints about bookings that have been completed. Complaints are reviewed by admins/staff for resolution.

**Function Details:**

**Data:** Users can provide:

- Booking ID
- Complaint message/description

**Validation:**

- User must be authenticated with role USER
- Booking must exist
- Booking status must be BOOKING_SUCCESS_WAIT_FOR_CONFIRMED
- Complaint message must not be empty

**Business Rules:** BR-40

**Normal & Abnormal Cases:**

**Normal:**

- Complaint created successfully
- Booking status changes to BOOKING_UNDER_COMPLAINT
- Complaint is visible to admins/staff
- A toast message is displayed: "Complaint submitted successfully"

**Abnormal:**

- User not authenticated
- Booking not found
- Booking not in correct status
- Complaint message is empty
- Network error
- A toast message is displayed with appropriate error
